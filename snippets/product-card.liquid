{% comment %}
  Product Card Snippet
  Usage: {% render 'product-card', product: product, show_vendor: false, show_rating: true, show_badges: true, show_quick_add: true, show_swatches: true, show_secondary_image: true, max_swatches: 5 %}
{% endcomment %}

{% liquid
  assign show_vendor = show_vendor | default: false
  assign show_rating = show_rating | default: true
  assign show_badges = show_badges | default: true
  assign show_quick_add = show_quick_add | default: true
  assign show_swatches = show_swatches | default: true
  assign show_secondary_image = show_secondary_image | default: true
  assign max_swatches = max_swatches | default: 5
  assign image_ratio = image_ratio | default: 'square'
  assign lazy_load = lazy_load | default: true
%}

<div class="product-card" data-product-id="{{ product.id }}" data-product-handle="{{ product.handle }}">
  
  {% comment %} Product Media {% endcomment %}
  <div class="product-card__media product-card__media--{{ image_ratio }}">
    <a href="{{ product.url }}" class="product-card__link" aria-label="{{ product.title | escape }}">
      {% if product.featured_image != blank %}
        <img 
          class="product-card__image product-card__image--primary"
          src="{{ product.featured_image | image_url: width: 600 }}"
          alt="{{ product.featured_image.alt | default: product.title | escape }}"
          {% if lazy_load %}loading="lazy"{% else %}loading="eager"{% endif %}
          width="600"
          height="{{ 600 | divided_by: product.featured_image.aspect_ratio | round }}"
        >
        {% if show_secondary_image and product.images.size > 1 %}
          <img 
            class="product-card__image product-card__image--secondary"
            src="{{ product.images[1] | image_url: width: 600 }}"
            alt="{{ product.images[1].alt | default: product.title | escape }}"
            loading="lazy"
            width="600"
            height="{{ 600 | divided_by: product.images[1].aspect_ratio | round }}"
          >
        {% endif %}
      {% else %}
        <div class="product-card__placeholder">
          {{ 'product-1' | placeholder_svg_tag: 'placeholder-svg' }}
        </div>
      {% endif %}
    </a>
    
    {% comment %} Product Badges {% endcomment %}
    {% if show_badges %}
      <div class="product-card__badges">
        {% if product.available == false %}
          <span class="product-badge product-badge--soldout">
            {{ 'products.product.sold_out' | t | default: 'Sold out' }}
          </span>
        {% elsif product.compare_at_price > product.price %}
          {% assign savings = product.compare_at_price | minus: product.price | times: 100 | divided_by: product.compare_at_price %}
          <span class="product-badge product-badge--sale">-{{ savings }}%</span>
        {% endif %}
        
        {% if product.tags contains 'new' %}
          <span class="product-badge product-badge--new">
            {{ 'products.product.new' | t | default: 'New' }}
          </span>
        {% endif %}
        
        {% if product.tags contains 'bestseller' or product.tags contains 'best-seller' %}
          <span class="product-badge product-badge--bestseller">
            {{ 'products.product.bestseller' | t | default: 'Bestseller' }}
          </span>
        {% endif %}
      </div>
    {% endif %}
    
    {% comment %} Quick Add Button {% endcomment %}
    {% if show_quick_add and product.available %}
      {% if product.variants.size == 1 %}
        <button 
          class="product-card__quick-add"
          type="button"
          data-product-id="{{ product.id }}"
          data-variant-id="{{ product.first_available_variant.id }}"
          aria-label="{{ 'products.product.add_to_cart' | t | default: 'Add to cart' }} - {{ product.title | escape }}"
        >
          <svg class="icon-plus" width="20" height="20" viewBox="0 0 20 20" fill="none" aria-hidden="true">
            <path d="M10 4V16M4 10H16" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
          </svg>
          <span>{{ 'products.product.quick_add' | t | default: 'Quick Add' }}</span>
        </button>
      {% else %}
        <a 
          href="{{ product.url }}"
          class="product-card__quick-add product-card__quick-add--options"
          aria-label="{{ 'products.product.choose_options' | t | default: 'Choose options' }} - {{ product.title | escape }}"
        >
          <svg class="icon-options" width="20" height="20" viewBox="0 0 20 20" fill="none" aria-hidden="true">
            <circle cx="10" cy="10" r="1.5" fill="currentColor"/>
            <circle cx="5" cy="10" r="1.5" fill="currentColor"/>
            <circle cx="15" cy="10" r="1.5" fill="currentColor"/>
          </svg>
          <span>{{ 'products.product.choose_options' | t | default: 'Choose Options' }}</span>
        </a>
      {% endif %}
    {% endif %}
    
    {% comment %} Wishlist Button (optional) {% endcomment %}
    {% if settings.show_wishlist %}
      <button 
        class="product-card__wishlist"
        type="button"
        data-product-id="{{ product.id }}"
        aria-label="{{ 'products.product.add_to_wishlist' | t | default: 'Add to wishlist' }}"
      >
        <svg width="20" height="20" viewBox="0 0 20 20" fill="none" aria-hidden="true">
          <path d="M10 17.5L8.55 16.19C4.4 12.48 1.5 9.88 1.5 6.69C1.5 4.09 3.52 2 6.05 2C7.54 2 8.97 2.69 10 3.8C11.03 2.69 12.46 2 13.95 2C16.48 2 18.5 4.09 18.5 6.69C18.5 9.88 15.6 12.48 11.45 16.19L10 17.5Z" stroke="currentColor" stroke-width="1.5"/>
        </svg>
      </button>
    {% endif %}
  </div>
  
  {% comment %} Product Info {% endcomment %}
  <div class="product-card__info">
    
    {% comment %} Star Rating {% endcomment %}
    {% if show_rating %}
      {% assign rating = product.metafields.reviews.rating.value | default: 0 %}
      {% assign rating_count = product.metafields.reviews.rating_count.value | default: 0 %}
      
      {% if rating > 0 %}
        <div class="product-card__rating" aria-label="{{ 'products.product.rating' | t | default: 'Rating' }}: {{ rating }} {{ 'products.product.out_of' | t | default: 'out of' }} 5">
          <div class="star-rating" role="img">
            {% for i in (1..5) %}
              {% if rating >= i %}
                <svg class="star star--filled" width="14" height="14" viewBox="0 0 14 14" aria-hidden="true">
                  <path d="M7 0L8.5 4.5H13.5L9.5 7.5L11 12.5L7 9.5L3 12.5L4.5 7.5L0.5 4.5H5.5L7 0Z" fill="currentColor"/>
                </svg>
              {% elsif rating > i | minus: 1 %}
                <svg class="star star--half" width="14" height="14" viewBox="0 0 14 14" aria-hidden="true">
                  <defs>
                    <linearGradient id="half-star-{{ product.id }}-{{ i }}">
                      <stop offset="50%" stop-color="currentColor"/>
                      <stop offset="50%" stop-color="transparent"/>
                    </linearGradient>
                  </defs>
                  <path d="M7 0L8.5 4.5H13.5L9.5 7.5L11 12.5L7 9.5L3 12.5L4.5 7.5L0.5 4.5H5.5L7 0Z" fill="url(#half-star-{{ product.id }}-{{ i }})" stroke="currentColor" stroke-width="0.5"/>
                </svg>
              {% else %}
                <svg class="star star--empty" width="14" height="14" viewBox="0 0 14 14" aria-hidden="true">
                  <path d="M7 0L8.5 4.5H13.5L9.5 7.5L11 12.5L7 9.5L3 12.5L4.5 7.5L0.5 4.5H5.5L7 0Z" stroke="currentColor" stroke-width="0.5" fill="none"/>
                </svg>
              {% endif %}
            {% endfor %}
          </div>
          {% if rating_count > 0 %}
            <span class="product-card__rating-count">({{ rating_count }})</span>
          {% endif %}
        </div>
      {% endif %}
    {% endif %}
    
    {% comment %} Vendor {% endcomment %}
    {% if show_vendor and product.vendor != blank %}
      <p class="product-card__vendor">
        <a href="{{ product.vendor | url_for_vendor }}">{{ product.vendor }}</a>
      </p>
    {% endif %}
    
    {% comment %} Title {% endcomment %}
    <h3 class="product-card__title">
      <a href="{{ product.url }}">{{ product.title }}</a>
    </h3>
    
    {% comment %} Color Swatches {% endcomment %}
    {% if show_swatches %}
      {% render 'color-swatches', product: product, max_visible: max_swatches %}
    {% endif %}
    
    {% comment %} Price {% endcomment %}
    <div class="product-card__price" data-product-price>
      {% if product.compare_at_price > product.price %}
        <span class="product-card__price--compare">
          <span class="visually-hidden">{{ 'products.product.regular_price' | t | default: 'Regular price' }}</span>
          {{ product.compare_at_price | money }}
        </span>
      {% endif %}
      
      <span class="product-card__price--current {% if product.compare_at_price > product.price %}product-card__price--sale{% endif %}">
        {% if product.price_varies %}
          <span class="product-card__price--from">{{ 'products.product.from' | t | default: 'From' }}</span>
        {% endif %}
        {{ product.price | money }}
      </span>
      
      {% if product.available == false %}
        <span class="product-card__price--soldout">
          {{ 'products.product.sold_out' | t | default: 'Sold out' }}
        </span>
      {% endif %}
    </div>
    
    {% comment %} Unit Price {% endcomment %}
    {% if product.selected_or_first_available_variant.unit_price_measurement %}
      <div class="product-card__unit-price">
        <span class="visually-hidden">{{ 'products.product.unit_price_label' | t | default: 'Unit price' }}</span>
        {{ product.selected_or_first_available_variant.unit_price | money }}
        <span>/</span>
        {% if product.selected_or_first_available_variant.unit_price_measurement.reference_value != 1 %}
          {{ product.selected_or_first_available_variant.unit_price_measurement.reference_value }}
        {% endif %}
        {{ product.selected_or_first_available_variant.unit_price_measurement.reference_unit }}
      </div>
    {% endif %}
    
  </div>
</div>

<style>
  .product-card {
    height: 100%;
    display: flex;
    flex-direction: column;
  }
  
  .product-card__media {
    position: relative;
    margin-bottom: 16px;
    border-radius: 4px;
    overflow: hidden;
    background-color: #f8f8f8;
  }
  
  .product-card__media--square .product-card__link {
    aspect-ratio: 1 / 1;
  }
  
  .product-card__media--portrait .product-card__link {
    aspect-ratio: 3 / 4;
  }
  
  .product-card__media--landscape .product-card__link {
    aspect-ratio: 4 / 3;
  }
  
  .product-card__link {
    display: block;
    position: relative;
    width: 100%;
  }
  
  .product-card__image {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: opacity 0.3s ease;
  }
  
  .product-card__image--secondary {
    opacity: 0;
  }
  
  .product-card__media:hover .product-card__image--primary {
    opacity: 0;
  }
  
  .product-card__media:hover .product-card__image--secondary {
    opacity: 1;
  }
  
  .product-card__placeholder {
    aspect-ratio: 1 / 1;
    background-color: #f0f0f0;
    display: flex;
    align-items: center;
    justify-content: center;
  }
  
  .product-card__placeholder .placeholder-svg {
    width: 50%;
    height: 50%;
    fill: #ccc;
  }
  
  .product-card__badges {
    position: absolute;
    top: 10px;
    left: 10px;
    display: flex;
    flex-direction: column;
    gap: 6px;
    z-index: 2;
  }
  
  .product-badge {
    display: inline-block;
    padding: 4px 10px;
    font-size: 11px;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    border-radius: 3px;
  }
  
  .product-badge--sale {
    background-color: #e74c3c;
    color: #fff;
  }
  
  .product-badge--soldout {
    background-color: #333;
    color: #fff;
  }
  
  .product-badge--new {
    background-color: #e8b04b;
    color: #fff;
  }
  
  .product-badge--bestseller {
    background-color: #27ae60;
    color: #fff;
  }
  
  .product-card__quick-add {
    position: absolute;
    bottom: 10px;
    left: 10px;
    right: 10px;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    padding: 12px;
    background-color: #fff;
    border: none;
    border-radius: 4px;
    font-size: 13px;
    font-weight: 500;
    color: #333;
    cursor: pointer;
    opacity: 0;
    transform: translateY(10px);
    transition: all 0.3s ease;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
    z-index: 3;
    text-decoration: none;
  }
  
  .product-card__media:hover .product-card__quick-add {
    opacity: 1;
    transform: translateY(0);
  }
  
  .product-card__quick-add:hover {
    background-color: #333;
    color: #fff;
  }
  
  .product-card__wishlist {
    position: absolute;
    top: 10px;
    right: 10px;
    width: 36px;
    height: 36px;
    display: flex;
    align-items: center;
    justify-content: center;
    background-color: #fff;
    border: none;
    border-radius: 50%;
    cursor: pointer;
    opacity: 0;
    transition: all 0.3s ease;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
    z-index: 3;
  }
  
  .product-card__media:hover .product-card__wishlist {
    opacity: 1;
  }
  
  .product-card__wishlist:hover {
    background-color: #e74c3c;
    color: #fff;
  }
  
  .product-card__wishlist.is-active svg path {
    fill: #e74c3c;
  }
  
  .product-card__info {
    flex: 1;
    display: flex;
    flex-direction: column;
  }
  
  .product-card__rating {
    display: flex;
    align-items: center;
    gap: 6px;
    margin-bottom: 8px;
  }
  
  .star-rating {
    display: flex;
    gap: 2px;
  }
  
  .star {
    color: #e8b04b;
  }
  
  .star--empty {
    color: #ddd;
  }
  
  .product-card__rating-count {
    font-size: 12px;
    color: #888;
  }
  
  .product-card__vendor {
    font-size: 12px;
    color: #888;
    margin: 0 0 4px;
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }
  
  .product-card__vendor a {
    color: inherit;
    text-decoration: none;
  }
  
  .product-card__vendor a:hover {
    color: #333;
  }
  
  .product-card__title {
    font-size: 14px;
    font-weight: 500;
    margin: 0 0 10px;
    line-height: 1.4;
  }
  
  .product-card__title a {
    color: #333;
    text-decoration: none;
    transition: color 0.2s ease;
  }
  
  .product-card__title a:hover {
    color: #e8b04b;
  }
  
  .product-card__price {
    margin-top: auto;
    display: flex;
    align-items: center;
    gap: 8px;
    flex-wrap: wrap;
  }
  
  .product-card__price--current {
    font-size: 15px;
    font-weight: 600;
    color: #333;
  }
  
  .product-card__price--sale {
    color: #e74c3c;
  }
  
  .product-card__price--compare {
    font-size: 13px;
    color: #888;
    text-decoration: line-through;
  }
  
  .product-card__price--from {
    font-size: 12px;
    color: #888;
    font-weight: 400;
  }
  
  .product-card__price--soldout {
    font-size: 13px;
    color: #888;
    font-style: italic;
  }
  
  .product-card__unit-price {
    font-size: 11px;
    color: #888;
    margin-top: 4px;
  }
  
  .visually-hidden {
    position: absolute;
    width: 1px;
    height: 1px;
    padding: 0;
    margin: -1px;
    overflow: hidden;
    clip: rect(0, 0, 0, 0);
    white-space: nowrap;
    border: 0;
  }
  
  @media (max-width: 768px) {
    .product-card__quick-add {
      opacity: 1;
      transform: translateY(0);
      position: relative;
      bottom: auto;
      left: auto;
      right: auto;
      margin-top: 10px;
      box-shadow: none;
      border: 1px solid #e5e5e5;
    }
    
    .product-card__wishlist {
      opacity: 1;
    }
    
    .product-card__title {
      font-size: 13px;
    }
    
    .product-card__price--current {
      font-size: 14px;
    }
  }
</style>
