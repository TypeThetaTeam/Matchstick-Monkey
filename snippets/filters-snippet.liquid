{% comment %}
  Collection Filters Snippet - Works with Shopify Search & Discovery App
  Replace the filter section in your collection-main.liquid with this
{% endcomment %}

{% comment %} Sidebar Filters {% endcomment %}
{% if section.settings.show_filters %}
  <aside class="collection-sidebar" id="collection-filters">
    <button class="filter-toggle-mobile" id="filter-toggle" aria-expanded="false" aria-controls="filter-content">
      <span>Filters</span>
      <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
        <path d="M5 7L10 12L15 7" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
      </svg>
    </button>
    
    <form data-filter-form class="filter-form" id="filter-content">
      {% for filter in collection.filters %}
        <div class="filter-group" data-filter-type="{{ filter.type }}">
          <button 
            type="button"
            class="filter-group__toggle" 
            aria-expanded="{% if section.settings.filters_expanded %}true{% else %}false{% endif %}"
            aria-controls="filter-{{ filter.label | handleize }}"
          >
            <span>{{ filter.label }}</span>
            <svg class="filter-icon" width="12" height="12" viewBox="0 0 12 12">
              <path d="M2 4L6 8L10 4" stroke="currentColor" stroke-width="1.5" fill="none"/>
            </svg>
          </button>
          
          <div class="filter-group__content {% if section.settings.filters_expanded %}is-open{% endif %}" id="filter-{{ filter.label | handleize }}">
            {% case filter.type %}
              {% when 'list' %}
                <ul class="filter-list">
                  {% for value in filter.values %}
                    <li class="filter-list__item">
                      <label class="filter-checkbox">
                        <input 
                          type="checkbox" 
                          name="{{ value.param_name }}"
                          value="{{ value.value }}"
                          id="filter-{{ filter.label | handleize }}-{{ forloop.index }}"
                          {% if value.active %}checked{% endif %}
                          {% if value.count == 0 and value.active == false %}disabled{% endif %}
                          data-filter-url="{{ value.url }}"
                          data-filter-url-remove="{{ filter.url_to_remove }}"
                        >
                        <span class="filter-checkbox__box"></span>
                        <span class="filter-checkbox__label">{{ value.label }}</span>
                        <span class="filter-checkbox__count">({{ value.count }})</span>
                      </label>
                    </li>
                  {% endfor %}
                </ul>
              
              {% when 'price_range' %}
  <div class="filter-price-range">
    <div class="filter-price-inputs">
      <div class="filter-price-field">
        <label for="filter-price-min-{{ filter.label | handleize }}">{{ cart.currency.symbol }}</label>
        <input 
          type="number" 
          id="filter-price-min-{{ filter.label | handleize }}"
          name="{{ filter.min_value.param_name }}"
          value="{% if filter.min_value.value %}{{ filter.min_value.value | divided_by: 100 }}{% endif %}"
          min="0"
          max="{{ filter.range_max | divided_by: 100 }}"
          placeholder="0"
          data-price-min
        >
      </div>
      <span class="filter-price-separator">-</span>
      <div class="filter-price-field">
        <label for="filter-price-max-{{ filter.label | handleize }}">{{ cart.currency.symbol }}</label>
        <input 
          type="number" 
          id="filter-price-max-{{ filter.label | handleize }}"
          name="{{ filter.max_value.param_name }}"
          value="{% if filter.max_value.value %}{{ filter.max_value.value | divided_by: 100 }}{% endif %}"
          min="0"
          max="{{ filter.range_max | divided_by: 100 }}"
          placeholder="{{ filter.range_max | divided_by: 100 }}"
          data-price-max
        >
      </div>
    </div>
    
    {% comment %} Optional: Add Apply button for price filter {% endcomment %}
    <button type="button" class="filter-price-apply" data-apply-price>Apply</button>
              
              {% when 'boolean' %}
                <label class="filter-checkbox">
                  <input 
                    type="checkbox" 
                    name="{{ filter.param_name }}" 
                    value="1"
                    {% if filter.active_values.size > 0 %}checked{% endif %}
                  >
                  <span class="filter-checkbox__box"></span>
                  <span class="filter-checkbox__label">{{ filter.label }}</span>
                </label>
            {% endcase %}
          </div>
        </div>
      {% endfor %}
      
      {% comment %} Active Filters & Clear {% endcomment %}
      {% assign active_filters_count = 0 %}
      {% for filter in collection.filters %}
        {% assign active_filters_count = active_filters_count | plus: filter.active_values.size %}
      {% endfor %}
      
      {% if active_filters_count > 0 %}
        <div class="filter-actions">
          <div class="active-filters">
            {% for filter in collection.filters %}
              {% for value in filter.active_values %}
                <a href="{{ value.url_to_remove }}" class="active-filter-tag" data-filter-remove>
                  {{ value.label }}
                  <svg width="10" height="10" viewBox="0 0 10 10">
                    <path d="M2 2L8 8M8 2L2 8" stroke="currentColor" stroke-width="1.5"/>
                  </svg>
                </a>
              {% endfor %}
            {% endfor %}
          </div>
          <a href="{{ collection.url }}?sort_by={{ collection.sort_by }}" class="filter-clear-all">Clear all filters</a>
        </div>
      {% endif %}
    </form>
  </aside>
{% endif %}
